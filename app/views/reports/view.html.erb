<!-- app/views/reports/show.html.erb -->
<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-6 flex justify-between items-center">
    <h1 class="text-3xl font-bold">Tech Insights Report</h1>
    <%= link_to 'Generate New Report', new_report_path,
        class: "bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300" %>
  </div>

  <!-- Flash Messages -->
  <div class="mb-6">
    <% flash.each do |type, message| %>
      <div class="<%= type == 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700' %> p-4 rounded-lg mb-4">
        <%= message %>
      </div>
    <% end %>
  </div>

  <!-- Report Details -->
  <% if @metadata.present? && @metadata.is_a?(Hash) %>
    <div class="bg-gray-100 p-4 rounded-lg mb-6">
      <h2 class="text-xl font-semibold mb-2">Report Overview</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div>
          <p class="text-gray-600">Date Range</p>
          <p class="font-medium"><%= @metadata[:date_range] || 'N/A' %></p>
        </div>
        <div>
          <p class="text-gray-600">Articles Analyzed</p>
          <p class="font-medium"><%= @metadata[:article_count] || 'N/A' %></p>
        </div>
        <div>
          <p class="text-gray-600">Report Type</p>
          <p class="font-medium"><%= @report.report_type&.titleize || 'N/A' %></p>
        </div>
        <div>
          <p class="text-gray-600">Detail Level</p>
          <p class="font-medium"><%= @report.detail_level&.titleize || 'N/A' %></p>
        </div>
      </div>
    </div>
  <% else %>
    <div class="bg-red-100 p-4 rounded-lg mb-6">
      <p class="text-red-700">No metadata available for this report.</p>
    </div>
  <% end %>

  <!-- Report Content -->
  <% if @report_data.present? && @report_data.is_a?(Hash) %>
    <div class="bg-white shadow-md rounded-lg p-6">
      <!-- Executive Summary -->
      <% if @report_data[:executive_summary].present? %>
        <section class="mb-8">
          <h2 class="text-2xl font-bold mb-4">Executive Summary</h2>
          <div class="text-gray-700 whitespace-pre-line">
            <%= @report_data[:executive_summary] %>
          </div>
        </section>
      <% end %>

      <!-- Key Trends -->
      <% if @report_data[:key_trends].present? && @report_data[:key_trends].is_a?(Array) %>
        <section class="mb-8">
          <h2 class="text-2xl font-bold mb-4">Key Trends</h2>
          <div class="space-y-4">
            <% @report_data[:key_trends].each do |trend| %>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="text-xl font-semibold mb-2"><%= trend[:title] %></h3>
                <p class="text-gray-700 mb-3"><%= trend[:description] %></p>

                <% if trend[:data].present? %>
                  <div class="mt-2">
                    <h4 class="font-medium text-gray-600 mb-2">Detailed Insights:</h4>
                    <% case trend[:title] %>
                    <% when "News Source Distribution" %>
                      <div class="grid grid-cols-2 gap-2">
                        <% trend[:data].each do |feed, count| %>
                          <div class="bg-white p-3 rounded shadow-sm">
                            <p class="font-medium">
                              <%= feed.is_a?(ActiveRecord::Base) ? feed.name : feed.to_s %>
                            </p>
                            <p class="text-gray-600"><%= count %> articles</p>
                          </div>
                        <% end %>
                      </div>
                    <% when "Publication Timing" %>
                      <div class="grid grid-cols-2 gap-2">
                        <% trend[:data].each do |day, count| %>
                          <div class="bg-white p-3 rounded shadow-sm">
                            <p class="font-medium"><%= day %></p>
                            <p class="text-gray-600"><%= count %> articles</p>
                          </div>
                        <% end %>
                      </div>
                    <% else %>
                      <% trend[:data].each do |key, value| %>
                        <div class="ml-4 mb-2">
                          <span class="font-medium"><%= key.to_s.titleize %>:</span>
                          <% if value.is_a?(Array) %>
                            <%= value.join(", ") %>
                          <% else %>
                            <%= value %>
                          <% end %>
                        </div>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </section>
      <% end %>

      <!-- Recommendations -->
      <% if @report_data[:recommendations].present? && @report_data[:recommendations].is_a?(Array) %>
        <section class="mb-8">
          <h2 class="text-2xl font-bold mb-4">Recommendations</h2>
          <div class="space-y-4">
            <% @report_data[:recommendations].each do |recommendation| %>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="text-xl font-semibold mb-2"><%= recommendation[:title] %></h3>
                <div class="grid grid-cols-2 gap-4 mb-3">
                  <div>
                    <span class="text-gray-600">Impact Level:</span>
                    <span class="ml-2 font-medium"><%= recommendation[:impact_level] %></span>
                  </div>
                  <div>
                    <span class="text-gray-600">Timeline:</span>
                    <span class="ml-2 font-medium"><%= recommendation[:timeline] %></span>
                  </div>
                </div>
                <p class="text-gray-700"><%= recommendation[:description] %></p>
              </div>
            <% end %>
          </div>
        </section>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12">
      <p class="text-gray-600">No report data available. Please <%= link_to 'generate a new report', new_report_path, class: 'text-blue-600 hover:underline' %>.</p>
    </div>
  <% end %>
</div>
