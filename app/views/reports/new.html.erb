<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-6 text-center">Generate Tech Insights Report</h1>

  <!-- Display Flash Errors -->
  <% if flash[:error] %>
    <div class="text-red-500 text-center mb-4">
      <%= flash[:error] %>
    </div>
  <% end %>

  <!-- Display fetched report data (if available) -->
  <% if @report_data.present? %>
    <div class="mb-6">
      <h2 class="text-2xl font-semibold text-gray-700">Fetched Report Data</h2>
      <ul class="list-disc pl-6 mt-4">
        <% @report_data.each do |data| %>
          <li><%= data %></li> <!-- You can adjust this based on the structure of your report data -->
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="max-w-md mx-auto bg-white shadow-md rounded-lg p-8">
    <%= form_with(url: generate_report_path, method: :post, local: true, class: "space-y-6") do |f| %>
      <div>
        <%= f.label :start_date, "Start Date", class: "block text-gray-700 font-bold mb-2" %>
        <%= f.date_field :start_date,
            required: true,
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div>
        <%= f.label :end_date, "End Date", class: "block text-gray-700 font-bold mb-2" %>
        <%= f.date_field :end_date,
            required: true,
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div>
        <%= f.label :report_type, "Report Type", class: "block text-gray-700 font-bold mb-2" %>
        <%= f.select :report_type,
            [
              ['Comprehensive Insights', 'comprehensive'],
              ['Executive Summary', 'executive'],
              ['Trend Analysis', 'trend']
            ],
            { prompt: "Select Report Type" },
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div>
        <%= f.label :detail_level, "Detail Level", class: "block text-gray-700 font-bold mb-2" %>
        <%= f.select :detail_level,
            [
              ['High (30 pages)', 'high'],
              ['Medium (20 pages)', 'medium'],
              ['Concise (10 pages)', 'low']
            ],
            { prompt: "Select Detail Level" },
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div class="flex items-center mb-4">
        <%= f.check_box :include_visualizations,
            class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-2" %>
        <%= f.label :include_visualizations, "Include Data Visualizations",
            class: "text-gray-900" %>
      </div>

      <div>
        <%= f.submit "Generate Report",
            class: "w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300" %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.querySelector('input[name="start_date"]');
    const endDateInput = document.querySelector('input[name="end_date"]');

    // Set max date to today
    const today = new Date().toISOString().split('T')[0];
    startDateInput.setAttribute('max', today);
    endDateInput.setAttribute('max', today);

    // Validate date range
    endDateInput.addEventListener('change', function() {
      if (startDateInput.value && this.value) {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(this.value);

        if (endDate < startDate) {
          alert('End date must be after start date');
          this.value = '';
        }

        // Ensure date range is not more than 30 days
        const daysDifference = (endDate - startDate) / (1000 * 60 * 60 * 24);
        if (daysDifference > 30) {
          alert('Please select a date range of 30 days or less');
          this.value = '';
        }
      }
    });
  });
</script>
