<h1>Articles</h1>

<!-- Date Range Filter Form -->
<%= form_tag(articles_path, method: :get, class: "date-filter-form") do %>
  <div>
    <label for="start_date">Start Date:</label>
    <%= date_field_tag :start_date, params[:start_date], class: "date-input" %>
  </div>
  <div>
    <label for="end_date">End Date:</label>
    <%= date_field_tag :end_date, params[:end_date], class: "date-input" %>
  </div>
  <div>
    <%= submit_tag "Filter", class: "filter-button" %>
  </div>
<% end %>

<!-- Display Total Articles -->
<% if @combined_articles.present? %>
  <p>
    <strong>Total Articles:</strong>
    <%= @combined_articles.total_count %>
  </p>

  <!-- Display Articles -->
  <% @combined_articles.each do |article| %>
    <div class="article-preview">
      <h2><%= link_to article.title, article_path(article) %></h2>

      <p>Source: <%= article.source_name %></p>

      <p>Published: <%= article.published_at&.strftime("%B %d, %Y") || "No date" %></p>

      <!-- Polymorphic AI Summary Display -->
      <% if article.respond_to?(:ai_summary) && article.ai_summary.present? %>
        <div class="ai-summary">
          <h3>AI Summary</h3>
          <%= simple_format(article.ai_summary.content) %>
        </div>
      <% else %>
        <p>No AI Summary available</p>
      <% end %>

      <hr>
    </div>
  <% end %>

  <%= paginate @combined_articles %>

<% else %>
  <p>No articles found. Try adjusting your filter or check your data sources.</p>
<% end %>
